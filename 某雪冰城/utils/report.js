Object.defineProperty(exports,"__esModule",{value:!0}),exports.store=exports.setReportParams=exports.batchReport=exports.addReportReq=exports.addReportItem=void 0;var e=require("./wx-api"),r=require("../cgi/index"),t=function(){return(t=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)},o=function(e,r){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)r.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(t[o[a]]=e[o[a]])}return t},a=[],n={reportParams:{openid:"",userEnable:!1,brandId:0,storeId:"",isNeedLoginAuth:!0,reportNonce:"",eventName:""}};exports.store=n;exports.setReportParams=function(e){n.reportParams=t(t({},n.reportParams),e)};exports.addReportItem=function(e,r){p(t(t({},n.reportParams),{eventName:e}),r)};exports.addReportReq=function(e,r,o){var a;void 0===o&&(o={}),p(t(t({},n.reportParams),{eventName:e,timeCost:Date.now()-r,returnCode:(null===(a=null==o?void 0:o.data)||void 0===a?void 0:a.errcode)||0}))};var p=function(e,r){var n=e.reportNonce,p=e.brandId,d=e.storeId,i=e.isNeedLoginAuth,u=e.eventName,c=void 0===u?"":u,l=e.userEnable,v=e.orderno,m=o(e,["reportNonce","brandId","storeId","isNeedLoginAuth","eventName","userEnable","orderno"]),b=t({eventName:c,reportTimestamp:Math.ceil(Date.now()/1e3),storeId:d,storeBrandId:p,userType:l?1:2,authorized:i?2:1,outTradeNo:v,extData1:r,extData4:n},m);c&&a.push(b),a.length>9&&s()},s=function(){if(a.length){var t=n.reportParams,o=t.brandId,p=t.storeId,s=t.isNeedLoginAuth,d={base:{brandId:o,storeId:p},openid:t.openid,reportList:a};a=[],s?(0,e.postReportLog)(d):r.MMPAY_LOVEFEAST_PLUGIN_LOGIC_SVR.log.report(d,{showLoading:!1})}};exports.batchReport=s;